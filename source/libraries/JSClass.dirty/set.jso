JS.Set=new JS.Class("Set",{extend:{forEach:function(a,b,c){if(!a||!b)return;if(a.forEach)return a.forEach(b,c);for(var d=0,e=a.length;d<e;d++)a[d]!==undefined&&b.call(c||null,a[d],d)}},include:JS.Enumerable||{},initialize:function(a,b,c){this.clear(),b?this.klass.forEach(a,function(a){this.add(b.call(c||null,a))},this):this.merge(a)},forEach:function(a,b){return a?(a=JS.Enumerable.toFn(a),this._0.forEachKey(a,b),this):this.enumFor("forEach")},add:function(a){return this.contains(a)?!1:(this._0.store(a,!0),this.length=this.size=this._0.length,!0)},classify:function(a,b){if(!a)return this.enumFor("classify");a=JS.Enumerable.toFn(a);var c=new JS.Hash;return this.forEach(function(f){var g=a.call(b||null,f);c.hasKey(g)||c.store(g,new this.klass),c.get(g).add(f)},this),c},clear:function(){this._0=new JS.Hash,this.size=this.length=0},complement:function(a){var b=new this.klass;return this.klass.forEach(a,function(a){this.contains(a)||b.add(a)},this),b},contains:function(a){return this._0.hasKey(a)},difference:function(a){a=JS.isType(a,JS.Set)?a:new JS.Set(a);var b=new this.klass;return this.forEach(function(d){a.contains(d)||b.add(d)}),b},divide:function(a,b){if(!a)return this.enumFor("divide");a=JS.Enumerable.toFn(a);var c=this.classify(a,b),d=new JS.Set;return c.forEachValue(d.method("add")),d},equals:function(a){if(this.length!==a.length||!JS.isType(a,JS.Set))return!1;var b=!0;return this.forEach(function(d){if(!b)return;a.contains(d)||(b=!1)}),b},hash:function(){var a=[];return this.forEach(function(c){a.push(JS.Hash.codeFor(c))}),a.sort().join("")},flatten:function(a){var b=new this.klass;return b._0=this._0,a||(a=this,a.clear()),b.forEach(function(b){JS.isType(b,JS.Set)?b.flatten(a):a.add(b)}),a},inspect:function(){return this.toString()},intersection:function(a){var b=new this.klass;return this.klass.forEach(a,function(a){this.contains(a)&&b.add(a)},this),b},isEmpty:function(){return this._0.length===0},isProperSubset:function(a){return this._0.length<a._0.length&&this.isSubset(a)},isProperSuperset:function(a){return this._0.length>a._0.length&&this.isSuperset(a)},isSubset:function(a){var b=!0;return this.forEach(function(d){if(!b)return;a.contains(d)||(b=!1)}),b},isSuperset:function(a){return a.isSubset(this)},merge:function(a){this.klass.forEach(a,function(a){this.add(a)},this)},product:function(a){var b=new JS.Set;return this.forEach(function(e){this.klass.forEach(a,function(a){b.add([e,a])})},this),b},rebuild:function(){this._0.rehash(),this.length=this.size=this._0.length},remove:function(a){this._0.remove(a),this.length=this.size=this._0.length},removeIf:function(a,b){return a?(a=JS.Enumerable.toFn(a),this._0.removeIf(function(d){return a.call(b||null,d.key)}),this.length=this.size=this._0.length,this):this.enumFor("removeIf")},replace:function(a){this.clear(),this.merge(a)},subtract:function(a){this.klass.forEach(a,function(a){this.remove(a)},this)},toString:function(){var a=[];return this.forEach(function(c){a.push(c.toString())}),this.klass.displayName+":{"+a.join(",")+"}"},union:function(a){var b=new this.klass;return b.merge(this),b.merge(a),b},xor:function(a){var b=new this.klass(a);return this.forEach(function(a){b[b.contains(a)?"remove":"add"](a)}),b},_1:function(a){var b=this._0.length,c=JS.Enumerable;while(b--)if(c.areEqual(a,this._0[b]))return b;return-1}}),JS.Set.alias({n:"intersection",u:"union",x:"product"}),JS.HashSet=JS.Set,JS.OrderedSet=new JS.Class("OrderedSet",JS.Set,{clear:function(){this._0=new JS.OrderedHash,this.size=this.length=0}}),JS.SortedSet=new JS.Class("SortedSet",JS.Set,{extend:{compare:function(a,b){return JS.isType(a,Object)?a.compareTo(b):a<b?-1:a>b?1:0}},forEach:function(a,b){return a?(a=JS.Enumerable.toFn(a),this.klass.forEach(this._0,a,b),this):this.enumFor("forEach")},add:function(a){var b=this._1(a,!0);return b===null?!1:(this._0.splice(b,0,a),this.length=this.size=this._0.length,!0)},clear:function(){this._0=[],this.size=this.length=0},contains:function(a){return this._1(a)!==-1},rebuild:function(){var a=this._0;this.clear(),this.merge(a)},remove:function(a){var b=this._1(a);if(b===-1)return;this._0.splice(b,1),this.length=this.size=this._0.length},removeIf:function(a,b){if(!a)return this.enumFor("removeIf");a=JS.Enumerable.toFn(a);var c=this._0,d=c.length;while(d--)a.call(b||null,c[d])&&this.remove(c[d]);return this},_1:function(a,b){var c=this._0,d=c.length,e=0,f=d,g=this.klass.compare,h=JS.Enumerable,i;if(d===0)return b?0:-1;g(a,c[0])<1&&(f=0,e=0),g(a,c[d-1])>0&&(f=0,e=d);while(!h.areEqual(a,c[e])&&f>.5)f/=2,e+=(g(a,c[e])>0?1:-1)*Math.round(f),e>0&&g(a,c[e-1])>0&&g(a,c[e])<1&&(f=0);while(c[e]&&!h.areEqual(a,c[e])&&g(a,c[e])===0)e+=1;return i=h.areEqual(a,c[e]),b?i?null:e:i?e:-1}}),JS.Enumerable.include({toSet:function(a,b,c){return a=a||JS.Set,new a(this,b,c)}});