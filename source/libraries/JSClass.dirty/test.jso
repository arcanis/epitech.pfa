JS.Test=new JS.Module("Test",{extend:{Unit:new JS.Module({extend:{AssertionFailedError:new JS.Class(Error,{initialize:function(a){this.message=a.toString()}})}}),filter:function(a,b){return this.Unit.AutoRunner.filter(a,b)}}}),JS.Test.Unit.extend({Util:new JS.Module({extend:{Observable:new JS.Module({extend:{NOTHING:{}},addListener:function(a,b,c){if(b===undefined)throw new Error("No callback was passed as a listener");return this.channels()[a]=this.channels()[a]||[],this.channels()[a].push([b,c]),b},removeListener:function(a,b,c){var d=this.channels()[a];if(!d)return;var e=d.length;while(e--)if(d[e][0]===b)return d.splice(e,1),b;return null},notifyListeners:function(a,b){var b=JS.array(arguments),a=b.shift(),c=this.channels()[a];if(!c)return 0;for(var d=0,e=c.length;d<e;d++)c[d][0].apply(c[d][1]||null,b);return c.length},channels:function(){return this.__channels__=this.__channels__||[]}})}})}),JS.Test.Unit.extend({Assertions:new JS.Module({assertBlock:function(a,b,c){typeof a=="function"&&(c=b,b=a,a=null),this.__wrapAssertion__(function(){if(!b.call(c||null))throw a=this.buildMessage(a||"assertBlock failed."),new JS.Test.Unit.AssertionFailedError(a)})},flunk:function(a){this.assertBlock(this.buildMessage(a||"Flunked"),function(){return!1})},assert:function(a,b){this.__wrapAssertion__(function(){this.assertBlock(this.buildMessage(b,"<?> is not true.",a),function(){return a})})},assertEqual:function(a,b,c){var d=this.buildMessage(c,"<?> expected but was\n<?>.",a,b);this.assertBlock(d,function(){return JS.Enumerable.areEqual(a,b)})},assertNotEqual:function(a,b,c){var d=this.buildMessage(c,"<?> expected not to be equal to\n<?>.",a,b);this.assertBlock(d,function(){return!JS.Enumerable.areEqual(a,b)})},assertNull:function(a,b){this.assertEqual(null,a,b)},assertNotNull:function(a,b){var c=this.buildMessage(b,"<?> expected not to be null.",a);this.assertBlock(c,function(){return a!==null})},assertKindOf:function(a,b,c){this.__wrapAssertion__(function(){var e=!b||typeof a=="string"?typeof b:b.klass||b.constructor,g=this.buildMessage(c,"<?> expected to be an instance of\n<?> but was\n<?>.",b,a,e);this.assertBlock(g,function(){return JS.isType(b,a)})})},assertRespondTo:function(a,b,c){this.__wrapAssertion__(function(){var e=this.buildMessage("","<?>\ngiven as the method name argument to #assertRespondTo must be a String.",b);this.assertBlock(e,function(){return typeof b=="string"});var g=a?a.constructor:typeof a;e=this.buildMessage(c,"<?>\nof type <?>\nexpected to respond to <?>.",a,g,b),this.assertBlock(e,function(){return a&&a[b]!==undefined})})},assertMatch:function(a,b,c){this.__wrapAssertion__(function(){var e=this.buildMessage(c,"<?> expected to match\n<?>.",b,a);this.assertBlock(e,function(){return JS.match(a,b)})})},assertNoMatch:function(a,b,c){this.__wrapAssertion__(function(){var e=this.buildMessage(c,"<?> expected not to match\n<?>.",b,a);this.assertBlock(e,function(){return typeof a.test=="function"?!a.test(b):!a.match(b)})})},assertSame:function(a,b,c){var d=this.buildMessage(c,"<?> expected to be the same as\n<?>.",a,b);this.assertBlock(d,function(){return b===a})},assertNotSame:function(a,b,c){var d=this.buildMessage(c,"<?> expected not to be the same as\n<?>.",a,b);this.assertBlock(d,function(){return b!==a})},assertInDelta:function(a,b,c,d){this.__wrapAssertion__(function(){this.assertKindOf("number",a),this.assertKindOf("number",b),this.assertKindOf("number",c),this.assert(c>=0,"The delta should not be negative");var e=this.buildMessage(d,"<?> and\n<?> expected to be within\n<?> of each other.",a,b,c);this.assertBlock(e,function(){return Math.abs(a-b)<=c})})},assertSend:function(a,b){this.__wrapAssertion__(function(){this.assertKindOf(Array,a,"assertSend requires an array of send information"),this.assert(a.length>=2,"assertSend requires at least a receiver and a message name");var d=this.buildMessage(b,"<?> expected to respond to\n<?(?)> with a true value.",a[0],JS.Test.Unit.AssertionMessage.literal(a[1]),a.slice(2));this.assertBlock(d,function(){return a[0][a[1]].apply(a[0],a.slice(2))})})},__processExceptionArgs__:function(a){var a=JS.array(a),b=typeof a[a.length-1]=="function"?null:a.pop(),c=a.pop(),d=JS.isType(a[a.length-1],"string")?a.pop():"",e=new JS.Enumerable.Collection(a);return[a,e,d,c,b]},assertThrow:function(){var a=this.__processExceptionArgs__(arguments),b=a[0],c=a[1],d=a[2],e=a[3],f=a[4];this.__wrapAssertion__(function(){var a=this.buildMessage(d,"<?> exception expected but none was thrown.",b),k;this.assertBlock(a,function(){try{e.call(f)}catch(a){return k=a,!0}return!1}),a=this.buildMessage(d,"<?> exception expected but was\n?",b,k),this.assertBlock(a,function(){return c.any(function(a){return JS.isType(k,a)||k.name&&k.name===a.name})})})},assertThrows:function(){return this.assertThrow.apply(this,arguments)},assertNothingThrown:function(){var a=this.__processExceptionArgs__(arguments),b=a[0],c=a[1],d=a[2],e=a[3],f=a[4];this.__wrapAssertion__(function(){try{e.call(f)}catch(a){if(b.length===0&&!JS.isType(a,JS.Test.Unit.AssertionFailedError)||c.any(function(b){return JS.isType(a,b)}))this.assertBlock(this.buildMessage(d,"Exception thrown:\n?",a),function(){return!1});else throw a}})},buildMessage:function(){var a=JS.array(arguments),b=a.shift(),c=a.shift();return new JS.Test.Unit.AssertionMessage(b,c,a)},__wrapAssertion__:function(a){this.__assertionWrapped__===undefined&&(this.__assertionWrapped__=!1);if(!!this.__assertionWrapped__)return a.call(this);this.__assertionWrapped__=!0;try{return this.addAssertion(),a.call(this)}finally{this.__assertionWrapped__=!1}},addAssertion:function(){}})}),JS.Test.Unit.extend({AssertionMessage:new JS.Class({extend:{Literal:new JS.Class({initialize:function(a){this._1f=a,this.toString=this.inspect},inspect:function(){return this._1f.toString()}}),literal:function(a){return new this.Literal(a)},Template:new JS.Class({extend:{create:function(a){var b=a?a.match(/\(\?\)|(?=[^\\])\?|(?:(?!\(\?\))(?:\\\?|[^\?]))+/g):[];return new this(b)}},initialize:function(a){this._V=new JS.Enumerable.Collection(a),this.count=this._V.findAll(function(a){return a==="?"||a==="(?)"}).length},result:function(a){if(a.length!==this.count)throw"The number of parameters does not match the number of substitutions.";var b=JS.array(a);return this._V.collect(function(a){return a==="(?)"?b.shift().replace(/^\[/,"(").replace(/\]$/,")"):a==="?"?b.shift():a.replace(/\\\?/g,"?")}).join("")}})},initialize:function(a,b,c){this._W=a,this._1g=b,this._1h=new JS.Enumerable.Collection(c)},template:function(){return this._1i=this._1i||this.klass.Template.create(this._1g)},addPeriod:function(a){return/\.$/.test(a)?a:a+"."},toString:function(){var a=[],b,c;return this._W&&a.push(this.addPeriod(this._W)),c=this.template().result(this._1h.collect(function(a){return JS.Console.convert(a)},this)),c!==""&&a.push(c),a.join("\n")}})}),JS.Test.Unit.extend({Failure:new JS.Class({extend:{SINGLE_CHARACTER:"F"},initialize:function(a,b){this._k=a,this._X=b},singleCharacterDisplay:function(){return this.klass.SINGLE_CHARACTER},shortDisplay:function(){return this._k+": "+this._X.split("\n")[0]},longDisplay:function(){return"Failure:\n"+this._k+":\n"+this._X},toString:function(){return this.longDisplay()}})}),JS.Test.Unit.extend({Error:new JS.Class({extend:{SINGLE_CHARACTER:"E"},initialize:function(a,b){this._k=a,this._l=b},singleCharacterDisplay:function(){return this.klass.SINGLE_CHARACTER},message:function(){return this._l.name+": "+this._l.message},shortDisplay:function(){return this._k+": "+this.message().split("\n")[0]},longDisplay:function(){return"Error:\n"+this._k+":\n"+this.message()},toString:function(){return this.longDisplay()}})}),JS.Test.Unit.extend({TestResult:new JS.Class({include:JS.Test.Unit.Util.Observable,extend:{CHANGED:"CHANGED",FAULT:"FAULT"},initialize:function(){this._Y=this._Z=0,this._b=[],this._m=[]},addRun:function(){this._Y+=1,this.notifyListeners(this.klass.CHANGED,this)},addFailure:function(a){this._b.push(a),this.notifyListeners(this.klass.FAULT,a),this.notifyListeners(this.klass.CHANGED,this)},addError:function(a){this._m.push(a),this.notifyListeners(this.klass.FAULT,a),this.notifyListeners(this.klass.CHANGED,this)},addAssertion:function(){this._Z+=1,this.notifyListeners(this.klass.CHANGED,this)},toString:function(){return this.runCount()+" tests, "+this.assertionCount()+" assertions, "+this.failureCount()+" failures, "+this.errorCount()+" errors"},passed:function(){return this._b.length===0&&this._m.length===0},runCount:function(){return this._Y},assertionCount:function(){return this._Z},failureCount:function(){return this._b.length},errorCount:function(){return this._m.length}})}),JS.Test.Unit.extend({TestSuite:new JS.Class({include:JS.Enumerable,extend:{STARTED:"Test.Unit.TestSuite.STARTED",FINISHED:"Test.Unit.TestSuite.FINISHED",forEach:function(a,b,c,d){var e=!1,f=a.length,g=-1,h=0,i=this.setTimeout,j=function(){h+=1,JS.Console.BROWSER?i(l,1):k()},k=function(){if(e)return;e=!0;while(h>0)l();e=!1},l=function(){g+=1,h-=1;if(g===f)return c&&c.call(d||null);b.call(d||null,a[g],j)};j()},setTimeout:function(){return typeof setTimeout=="undefined"?undefined:setTimeout}()},initialize:function(a){this._c=a||"Unnamed TestSuite",this._3=[]},forEach:function(a,b,c){this.klass.forEach(this._3,a,b,c)},run:function(a,b,c,d){c.call(d||null,this.klass.STARTED,this._c),this.forEach(function(b,e){b.run(a,e,c,d)},function(){c.call(d||null,this.klass.FINISHED,this._c),b.call(d||null)},this)},push:function(a){return this._3.push(a),this},remove:function(a){var b=this._3.length;while(b--)this._3[b]===a&&this._3.splice(b,1)},size:function(){var a=0,b=this._3.length;while(b--)a+=this._3[b].size();return a},empty:function(){return this._3.length===0},toString:function(){return this._c}})}),JS.Test.Unit.extend({TestCase:new JS.Class({include:JS.Test.Unit.Assertions,extend:[JS.Enumerable,{testCases:[],reports:[],clear:function(){this.testCases=[]},inherited:function(a){this.testCases.push(a)},forEach:function(a,b){for(var c=0,d=this.testCases.length;c<d;c++)a.call(b||null,this.testCases[c])},STARTED:"Test.Unit.TestCase.STARTED",FINISHED:"Test.Unit.TestCase.FINISHED",suite:function(a,b,c){var d=new JS.Enumerable.Collection(this.instanceMethods(b)),e=d.select(function(b){return this.filter(b,a)},this).sort(),f=new JS.Test.Unit.TestSuite(this.displayName);for(var g=0,h=e.length;g<h;g++)try{f.push(new this(e[g]))}catch(i){}if(f.empty()&&c)try{f.push(new this("defaultTest"))}catch(i){}return f},filter:function(a,b){if(!/^test./.test(a))return!1;if(!b||b.length===0)return!0;var c=b.length;while(c--)if(a.substr(6,b[c].length)===b[c])return!0;return!1}}],initialize:function(a){if(typeof this[a]!="function")throw"invalid_test";this._1=a,this._B=!0},run:function(a,b,c,d){c.call(d||null,this.klass.STARTED,this),this._2=a;var e=function(){this.exec("teardown",function(){this.exec(function(){JS.Test.Unit.mocking.verify()},function(){a.addRun(),c.call(d||null,this.klass.FINISHED,this),b()})})};this.exec("setup",function(){this.exec(this._1,e)},e)},exec:function(a,b,c){if(!a)return b.call(this);c||(c=b);var d=typeof a=="function"?a.length:this.__eigen__().instanceMethod(a).arity,e=typeof a=="function"?a:this[a],f=this;if(d===0)return this._10(function(){e.call(this),b.call(this)},this.processError(c));this._10(function(){e.call(this,function(a){f.exec(a,b,c)})},this.processError(c))},processError:function(a){return function(c){JS.isType(c,JS.Test.Unit.AssertionFailedError)?this.addFailure(c.message):this.addError(c),a&&a.call(this)}},_10:function(a,b,c){try{a.call(this)}catch(d){b&&b.call(this,d)}finally{c&&c.call(this)}},setup:function(a){a()},teardown:function(a){a()},defaultTest:function(){return this.flunk("No tests were specified")},passed:function(){return this._B},size:function(){return 1},addAssertion:function(){this._2.addAssertion()},addFailure:function(a){this._B=!1,this._2.addFailure(new JS.Test.Unit.Failure(this.name(),a))},addError:function(a){this._B=!1,this._2.addError(new JS.Test.Unit.Error(this.name(),a))},name:function(){var a=this._1.replace(/^test\W*/ig,"");return a.replace(this.klass.displayName,"")===a?this._1+"("+this.klass.displayName+")":a},toString:function(){return this.name()}})}),JS.Test.Unit.extend({UI:new JS.Module({extend:{SILENT:1,PROGRESS_ONLY:2,NORMAL:3,VERBOSE:4,TestRunnerUtilities:new JS.Module({run:function(a,b){return(new this(a,b||JS.Test.Unit.UI.NORMAL)).start()},getFilter:function(){if(JS.ENV.location&&/\btest=/.test(location.search)){var a=[],b=location.search.match(/\btest=([^&]+)/)[1].split(","),c=b.length;while(c--)a.push(decodeURIComponent(b[c]));return a}return typeof process=="object"?process.argv.slice(2):[]}})}})}),JS.Test.Unit.UI.extend({TestRunnerMediator:new JS.Class({extend:{RESET:"Test.Unit.UI.TestRunnerMediator.RESET",STARTED:"Test.Unit.UI.TestRunnerMediator.STARTED",FINISHED:"Test.Unit.UI.TestRunnerMediator.FINISHED"},include:JS.Test.Unit.Util.Observable,initialize:function(a){this._5=a},runSuite:function(){var a=(new Date).getTime();this.notifyListeners(this.klass.RESET,this._5.size());var b=this.createResult();this.notifyListeners(this.klass.STARTED,b);var c=JS.bind(function(){b.removeListener(JS.Test.Unit.TestResult.FAULT,e),b.removeListener(JS.Test.Unit.TestResult.CHANGED,d);var c=(new Date).getTime(),f=(c-a)/1e3,i=!0,l=JS.Test.Unit.TestCase.reports,m=l.length;while(m--)JS.Console.output(""),i=i&&l[m].report();JS.Test.Unit.TestCase.reports=[],this.notifyListeners(this.klass.FINISHED,f,i)},this),d=b.addListener(JS.Test.Unit.TestResult.CHANGED,function(a){this.notifyListeners(JS.Test.Unit.TestResult.CHANGED,a)},this),e=b.addListener(JS.Test.Unit.TestResult.FAULT,function(a){this.notifyListeners(JS.Test.Unit.TestResult.FAULT,a)},this);this._5.run(b,c,function(a,b){this.notifyListeners(a,b)},this)},createResult:function(){return new JS.Test.Unit.TestResult}})}),JS.Test.Unit.UI.extend({Console:new JS.Module({extend:{TestRunner:new JS.Class({extend:JS.Test.Unit.UI.TestRunnerUtilities,include:JS.Console,initialize:function(a,b){this._5=typeof a.suite=="function"?a.suite():a,this._1j=b||JS.Test.Unit.UI.NORMAL,this._C=!1,this._n=[]},start:function(){return this._D(),this._E(),this._F()},_D:function(){this._0=this._G(this._5);var a=this._5.toString();JS.isType(this._5,JS.Module)&&(a=this._5.displayName),this.consoleFormat("bold"),this._d("Loaded suite "+a)},_G:function(a){return new JS.Test.Unit.UI.TestRunnerMediator(a)},_E:function(){this._0.addListener(JS.Test.Unit.TestResult.FAULT,this.method("_H")),this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.STARTED,this.method("_I")),this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.FINISHED,this.method("_J")),this._0.addListener(JS.Test.Unit.TestCase.STARTED,this.method("_K")),this._0.addListener(JS.Test.Unit.TestCase.FINISHED,this.method("_L"))},_F:function(){return this._0.runSuite()},_H:function(a){this._n.push(a),this.consoleFormat("bold","red"),this._M(a.singleCharacterDisplay(),JS.Test.Unit.UI.PROGRESS_ONLY),this.reset(),this._C=!0},_I:function(a){this._2=a,this._p(),this.reset(),this._d("Started")},_J:function(a,b){for(var c=0,d=this._n.length;c<d;c++){var e=this._n[c].longDisplay(),f=e.split("\n"),g=f.shift(),h=f.shift(),i;this.consoleFormat("bold","red"),this._p(),this._d("\n"+(c+1)+") "+g),this._d(h),this.reset();while(i=f.shift())this.puts(i)}this.reset(),this._p(),this._d("Finished in "+a+" seconds");var j=b&&this._2.passed(),k=j?"green":"red";this.consoleFormat(k),this._d(this._2,JS.Test.Unit.UI.PROGRESS_ONLY),this.reset(),this.puts("");var l=j?0:1;typeof WScript!="undefined"&&WScript.Quit(l),typeof process=="object"&&process.exit(l),typeof system=="object"&&system.exit&&system.exit(l),typeof quit=="function"&&quit(l)},_K:function(a){this._M(a.name()+": ",JS.Test.Unit.UI.VERBOSE)},_L:function(a){this.consoleFormat("green"),this._C||this._M(".",JS.Test.Unit.UI.PROGRESS_ONLY),this.reset(),this._p(JS.Test.Unit.UI.VERBOSE),this._C=!1},_p:function(a){this._d("",a||JS.Test.Unit.UI.NORMAL)},_d:function(a,b){if(!this._11(b||JS.Test.Unit.UI.NORMAL))return;this.puts(a)},_M:function(a,b){if(!this._11(b||JS.Test.Unit.UI.NORMAL))return;this.print(a)},_11:function(a){return a<=this._1j}})}})}),JS.Test.Unit.UI.extend({Browser:new JS.Module({extend:{TestRunner:new JS.Class({extend:JS.Test.Unit.UI.TestRunnerUtilities,initialize:function(a,b){this._5=typeof a.suite=="function"?a.suite():a,this._n=[],this._6()},_6:function(){return this._1k=this._1k||new this.klass.Display},start:function(){return this._D(),this._E(),this._F()},_D:function(){this._0=this._G(this._5)},_G:function(a){return new JS.Test.Unit.UI.TestRunnerMediator(a)},_E:function(){this._0.addListener(JS.Test.Unit.TestResult.CHANGED,this.method("_1l")),this._0.addListener(JS.Test.Unit.TestResult.FAULT,this.method("_H")),this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.STARTED,this.method("_I")),this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.FINISHED,this.method("_J")),this._0.addListener(JS.Test.Unit.TestCase.STARTED,this.method("_K")),this._0.addListener(JS.Test.Unit.TestCase.FINISHED,this.method("_L"));if(!window.TestSwarm)return;TestSwarm.serialize=this.method("serialize"),this._0.addListener(JS.Test.Unit.TestCase.FINISHED,TestSwarm.heartbeat),this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.FINISHED,function(){TestSwarm.submit(this._12())},this)},_12:function(){return{fail:this._2.failureCount(),error:this._2.errorCount(),total:this._2.runCount()}},_F:function(){return this._0.runSuite()},_1l:function(){this._6().setTestCount(this._2.runCount()),this._6().setAssertionCount(this._2.assertionCount()),this._6().setFailureCount(this._2.failureCount()),this._6().setErrorCount(this._2.errorCount())},_H:function(a){this._n.push(a),this._13="failed",this._6().addFault(this._1m,a)},_I:function(a){this._2=a},_J:function(a){this._6().printSummary(a),this._14({jstest:this._12()})},_K:function(a){this._1m=a,this._13="passed",this._6().addTestCase(a)},_L:function(a){this._6().finishTestCase(a),this._14({jstest:{test:a.toString(),status:this._13}})},_14:function(a){window.console&&window.JSON&&!window.Components&&console.log(JSON.stringify(a))},serialize:function(){var a=document.getElementsByTagName("li"),b=a.length;while(b--)JS.DOM.removeClass(a[b],"closed");var a=document.getElementsByTagName("script"),b=a.length;while(b--)a[b].parentNode.removeChild(a[b]);var c=document.getElementsByTagName("html")[0];return"<!doctype html><html>"+c.innerHTML+"</html>"}})}})}),JS.Test.Unit.UI.Browser.TestRunner.extend({Display:new JS.Class({extend:{Context:new JS.Class({initialize:function(a,b,c){this._7=b,this._8=a,this._c=c,this._N=[];if(c===undefined){this._O=b;return}this._P(c)},_P:function(a){var b=this,c=this._7._O||this._7,d={_3:"Tests",_b:"Failed"};this._q=(new JS.DOM.Builder(c)).li({className:this._8+" passed"},function(c){c.ul({className:"stats"},function(a){for(var c in d)a.li(function(a){a.span({className:"label"},d[c]+": "),b[c]=a.span({className:"number"},"0")})}),a&&(b._r=c.p({className:b._8+"-name"},a),b._8==="spec"&&(b._s=JS.DOM.span({className:"runner"},"Run"),b._s.style.background='url("'+JSCLASS_PATH+'assets/bullet_go.png") center center no-repeat',b._r.insertBefore(b._s,b._r.firstChild))),b._O=c.ul({className:"children"})}),/\btest=/.test(window.location.search)||JS.DOM.addClass(this._q,"closed"),JS.DOM.Event.on(this._r,"click",function(){JS.DOM.toggleClass(this._q,"closed")},this),this._s&&JS.DOM.Event.on(this._s,"click",this.runTest,this)},child:function(a){return this._N[a]=this._N[a]||new this.klass("spec",this,a)},addTest:function(a){var b=this._N[a]=new this.klass("test",this,a);b.ping("_3")},addFault:function(a){var b=JS.DOM.li({className:"fault"},function(b){b.p(function(b){var c=a.split(/[\r\n]+/);c.splice(1,1);for(var d=0,e=c.length;d<e;d++)d>0&&b.br(),b.concat(c[d])})});this._O.appendChild(b),this.ping("_b"),this.fail()},getName:function(){var a=[],b=this._7&&this._7.getName&&this._7.getName();return b&&a.push(b),a.push(this._c),a.join(" ")},runTest:function(){window.location.search="test="+encodeURIComponent(this.getName())},ping:function(a){if(!this[a])return;this[a].innerHTML=parseInt(this[a].innerHTML)+1,this._7.ping&&this._7.ping(a)},fail:function(){if(!this._q)return;JS.DOM.removeClass(this._q,"passed"),JS.DOM.addClass(this._r,"failed"),this._7.fail&&this._7.fail()}})},initialize:function(){this._P(),document.body.insertBefore(this._1n,document.body.firstChild)},_P:function(){var a=this;a._1n=JS.DOM.div({className:"test-result-container"},function(b){b.table({className:"report"},function(b){b.thead(function(a){a.tr(function(a){a.th({scope:"col"},"Tests"),a.th({scope:"col"},"Assertions"),a.th({scope:"col"},"Failures"),a.th({scope:"col"},"Errors")})}),b.tbody(function(b){b.tr(function(b){a._3=b.td(),a._1o=b.td(),a._b=b.td(),a._m=b.td()})})}),a._15=b.div({className:"light light-pending"}),b.p({className:"user-agent"},window.navigator.userAgent),a._1p=new a.klass.Context("spec",b.ul({className:"specs"})),a._1q=b.p({className:"summary"})})},setTestCount:function(a){this._3.innerHTML=String(a)},setAssertionCount:function(a){this._1o.innerHTML=String(a)},setFailureCount:function(a){this._b.innerHTML=String(a)},setErrorCount:function(a){this._m.innerHTML=String(a)},addTestCase:function(a){var b=this._16(a),c=b.name,d=b.context;d.addTest(c)},finishTestCase:function(a){},addFault:function(a,b){var c=this._16(a),d=c.name,e=c.context;e.child(d).addFault(b.longDisplay()),this._1r=!0},printSummary:function(a){JS.DOM.removeClass(this._15,"light-pending"),JS.DOM.addClass(this._15,this._1r?"light-failed":"light-passed"),this._1q.innerHTML="Finished in "+a+" seconds"},_16:function(a){var b=a.name(),c=a.klass,d=c.getContextName?c.getContextName():c.displayName,e=new JS.Enumerable.Collection;b=b.replace(d,"").replace(d,"").replace(/\(.*?\)$/g,"").replace(/^test\W+/g,"");while(c!==JS.Test.Unit.TestCase)e.push(c),c=c.superclass;return d=e.reverseForEach().inject(this._1p,function(a,b){return a.child(b._t||b.displayName)}),{name:b,context:d}}})}),JS.Test.Unit.extend({AutoRunner:new JS.Class({extend:{run:function(a){var b=this.getRunner(),c=b.getFilter(),d=[],e=[];JS.Test.Unit.TestCase.resolve(),JS.Test.Unit.TestCase.forEach(function(a){var b=a.suite(c);b.size()>0&&e.push(b),a.superclass===JS.Test.Unit.TestCase&&d.push(a.displayName)});var f=new JS.Test.Unit.TestSuite(d.join(", "));for(var g=0,h=e.length;g<h;g++)f.push(e[g]);return JS.Test.Unit.TestCase.clear(),b.run(f,this.OUTPUT_LEVELS[a||"normal"])},filter:function(a,b){var c=this.getRunner().getFilter(),d=[],e=c.length,f,g;if(e===0)return a;while(e--){f=a.length;while(f--)g=a[f].replace(new RegExp(b+"$"),""),c[e].substr(0,g.length)===g&&d.push(a[f])}return d},getRunner:function(){return typeof window!="undefined"?this.RUNNERS.browser:this.RUNNERS.console},RUNNERS:{console:JS.Test.Unit.UI.Console.TestRunner,browser:JS.Test.Unit.UI.Browser.TestRunner},OUTPUT_LEVELS:{silent:JS.Test.Unit.UI.SILENT,progress:JS.Test.Unit.UI.PROGRESS_ONLY,normal:JS.Test.Unit.UI.NORMAL,verbose:JS.Test.Unit.UI.VERBOSE}}})}),JS.Test.extend({autorun:JS.Test.Unit.AutoRunner.method("run")}),JS.Test.extend({Context:new JS.Module({extend:{included:function(a){a.extend(JS.Test.Context.Context,{_f:!1}),a.include(JS.Test.Context.LifeCycle,{_f:!1}),a.extend(JS.Test.Context.Test,{_f:!1}),a.include(JS.Console)},Context:new JS.Module({getContextName:function(){return this._t=this._t||"",typeof this.superclass.getContextName=="function"?(this.superclass.getContextName()+" "+this._t).replace(/^\s+/,""):this.displayName},setContextName:function(a){this._t=a},context:function(a,b){var c=new JS.Class(this,{},{_f:!1});return c.__eigen__().resolve(),c.setContextName(a.toString()),c.setName(c.getContextName()),b.call(c),c},cover:function(a){var b=new JS.Test.Coverage(a);this.before_all_callbacks.push(b.method("attach")),this.after_all_callbacks.push(b.method("detach")),JS.Test.Unit.TestCase.reports.push(b)}})}}),describe:function(a,b){var c=new JS.Class(a.toString(),JS.Test.Unit.TestCase,{},{_f:!1});return c.include(JS.Test.Context,{_f:!1}),c.__eigen__().resolve(),b.call(c),c}}),JS.Test.Context.Context.alias({describe:"context"}),JS.Test.extend({context:JS.Test.describe}),JS.Test.Context.LifeCycle=new JS.Module({extend:{included:function(a){a.extend(this.ClassMethods),a.before_all_callbacks=[],a.before_each_callbacks=[],a.after_all_callbacks=[],a.after_each_callbacks=[],a.before_should_callbacks={},a.extend({inherited:function(a){this.callSuper(),a.before_all_callbacks=[],a.before_each_callbacks=[],a.after_all_callbacks=[],a.after_each_callbacks=[],a.before_should_callbacks={}}})},ClassMethods:new JS.Module({before:function(a,b){if(typeof a=="function"||!b)b=a,a="each";this["before_"+(a+"_")+"callbacks"].push(b)},after:function(a,b){if(typeof a=="function"||!b)b=a,a="each";this["after_"+(a+"_")+"callbacks"].push(b)},gatherCallbacks:function(a,b){var c=typeof this.superclass.gatherCallbacks=="function"?this.superclass.gatherCallbacks(a,b):[],d=this[a+"_"+(b+"_")+"callbacks"];return a==="before"?c.concat(d):d.concat(c)}})},setup:function(a){var b=this;this.callSuper(function(){b.klass.before_should_callbacks[b._1]&&b.klass.before_should_callbacks[b._1].call(b),b.runCallbacks("before","each",a)})},teardown:function(a){var b=this;this.callSuper(function(){b.runCallbacks("after","each",a)})},runCallbacks:function(a,b,c){var d=this.klass.gatherCallbacks(a,b);JS.Test.Unit.TestSuite.forEach(d,function(a,b){this.exec(a,b)},c,this)},runAllCallbacks:function(a,b,c){var d=this.instanceVariables();this.runCallbacks(a,"all",function(){var a=this.instanceVariables().inject({},function(a,b){return d.member(b)?a:(a[b]=this[b],a)},this);b&&b.call(c||null,a)})},setValuesFromCallbacks:function(a){for(var b in a)this[b]=a[b]},instanceVariables:function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&a.push(b);return new JS.Enumerable.Collection(a)}}),function(){var a=JS.Test.Context.LifeCycle.ClassMethods.method("instanceMethod");JS.Test.Context.LifeCycle.ClassMethods.include({setup:a("before"),teardown:a("after")})}(),JS.Test.Context.extend({SharedBehavior:new JS.Class(JS.Module,{extend:{createFromBehavior:function(a){var b=new this;return b._1s=a,b},moduleName:function(a){return a.toLowerCase().replace(/[\s:',\.~;!#=\(\)&]+/g,"_").replace(/\/(.?)/g,function(a,b){return"."+b.toUpperCase()}).replace(/(?:^|_)(.)/g,function(a,b){return b.toUpperCase()})}},included:function(a){this._1s.call(a)}})}),JS.Test.Unit.TestCase.extend({shared:function(a,b){a=JS.Test.Context.SharedBehavior.moduleName(a),JS.ENV[a]=JS.Test.Context.SharedBehavior.createFromBehavior(b)},use:function(a){if(JS.isType(a,JS.Test.Context.SharedBehavior)||JS.isType(a,JS.Module))this.include(a);else if(JS.isType(a,"string")){var b=JS.Test.Context.SharedBehavior.moduleName(a),c=JS.ENV[b];if(!c)throw new Error('Could not find example group named "'+a+'"');this.include(c)}}}),function(){var a=function(a,b){var c={};for(var d=0,e=b.length;d<e;d++)c[b[d]]=JS.Test.Unit.TestCase[a];JS.Test.Unit.TestCase.extend(c)};a("shared",["sharedBehavior","shareAs","shareBehaviorAs","sharedExamplesFor"]),a("use",["uses","itShouldBehaveLike","behavesLike","usesExamplesFrom"])}(),JS.Test.Context.Test=new JS.Module({test:function(a,b,c){var d="test:",e=this.getContextName();e&&(d+=" "+e),d+=" "+a;if(this.instanceMethod(d))throw new Error(d+" is already defined in "+this.displayName);b=b||{},typeof b=="function"?c=b:b.before!==undefined&&(this.before_should_callbacks[d]=b.before),this.define(d,c,{_f:!1})},beforeTest:function(a,b){this.test(a,{before:b},function(){})}}),JS.Test.Context.Test.alias({it:"test",should:"test",tests:"test",beforeIt:"beforeTest",beforeShould:"beforeTest",beforeTests:"beforeTest"}),function(){var a=JS.Test.Unit.TestCase.suite;JS.Test.Unit.TestCase.extend({suite:function(c){return a.call(this,c,!1,!1)}})}(),JS.Test.Unit.TestSuite.include({run:function(a,b,c,d){c.call(d||null,this.klass.STARTED,this._c);var e=function(e){this.forEach(function(b,f){e&&b.setValuesFromCallbacks(e),b.run(a,f,c,d)},function(){var a=function(){c.call(d||null,this.klass.FINISHED,this._c),b()};e?f.runAllCallbacks("after",a,this):a.call(this)},this)},f=this._3[0],g=null;f&&f.runAllCallbacks?f.runAllCallbacks("before",e,this):e.call(this,null)}}),JS.Test.extend({Mocking:new JS.Module({extend:{ExpectationError:new JS.Class(JS.Test.Unit.AssertionFailedError),UnexpectedCallError:new JS.Class(Error,{initialize:function(a){this.message=a.toString()}}),__activeStubs__:[],stub:function(a,b,c){var d=!1;a==="new"&&(a=b,b=c,c=undefined,d=!0),JS.isType(a,"string")&&(c=b,b=a,a=JS.ENV);var e=this.__activeStubs__,f=e.length;while(f--)if(e[f]._9===a&&e[f]._1===b)return e[f].defaultMatcher(c);var g=new JS.Test.Mocking.Stub(a,b,d);return e.push(g),g.defaultMatcher(c)},removeStubs:function(){var a=this.__activeStubs__,b=a.length;while(b--)a[b].revoke();this.__activeStubs__=[]},verify:function(){try{var a=this.__activeStubs__;for(var b=0,c=a.length;b<c;b++)a[b]._1t()}finally{this.removeStubs()}},Stub:new JS.Class({initialize:function(a,b,c){this._9=a,this._1=b,this._u=c,this._g=a[b],this._1u=a.hasOwnProperty?a.hasOwnProperty(b):typeof this._g!="undefined";var d=JS.Test.Mocking;this._v=[],this._h=new d.Parameters([new d.AnyArgs]),this._a=!1,this.apply()},defaultMatcher:function(a){return a!==undefined&&typeof a!="function"?(this._9[this._1]=a,this):(this._17(),this._4=this._h,typeof a=="function"&&(this._4._18=a),this)},apply:function(){var a=this._9,b=this._1;if(a[b]!==this._g)return;var c=this;this._19=function(){return c._1v(this,arguments)},a[b]=this._19},revoke:function(){if(this._1u)this._9[this._1]=this._g;else try{delete this._9[this._1]}catch(a){this._9[this._1]=undefined}},expected:function(){this._a=!0,this._h._a=!0},_17:function(){this._4&&(this._4._1a=!0)},_1v:function(a,b){this._17();var c=this._v.concat(this._h),d,e,f;if(!this._u||a instanceof this._19){this._h.ping();for(var g=0,h=c.length;g<h;g++){d=c[g],e=d.match(b);if(!e)continue;d!==this._h&&d.ping();if(typeof e=="function")return e.apply(this._9,b);if(e===!0)return d.nextReturnValue();if(e.callback)return e.callback.apply(e.context,d.nextYieldArgs());if(e.exception)throw e.exception}throw this._u?f=new JS.Test.Unit.AssertionMessage("","<?> constructed with unexpected arguments:\n(?)",[this._g,JS.array(b)]):f=new JS.Test.Unit.AssertionMessage("","<?> received call to "+this._1+"() with unexpected arguments:\n(?)",[this._9,JS.array(b)]),new JS.Test.Mocking.UnexpectedCallError(f)}throw f=new JS.Test.Unit.AssertionMessage("",'<?> expected to be a constructor but called without "new"',[this._g]),new JS.Test.Mocking.UnexpectedCallError(f)},_1t:function(){if(!this._a)return;for(var a=0,b=this._v.length;a<b;a++)this._1b(this._v[a]);this._1b(this._h)},_1b:function(a){var b=this._u?this._g:this._9;a.verify(b,this._1,this._u)}})}})}),JS.Test.Mocking.extend({Parameters:new JS.Class({initialize:function(a,b){this._1c=JS.array(a),this._a=b,this._1a=!1,this._i=0},toArray:function(){var a=this._1c.slice();return this._j&&a.push(new JS.Test.Mocking.InstanceOf(Function)),a},returns:function(a){this._Q=0,this._R=a},nextReturnValue:function(){if(!this._R)return undefined;var a=this._R[this._Q];return this._Q=(this._Q+1)%this._R.length,a},yields:function(a){this._S=0,this._j=a},nextYieldArgs:function(){if(!this._j)return undefined;var a=this._j[this._S];return this._S=(this._S+1)%this._j.length,a},setMinimum:function(a){this._a=!0,this._T=a},setMaximum:function(a){this._a=!0,this._w=a},setExpected:function(a){this._a=!0,this._x=a},match:function(a){if(!this._1a)return!1;var b=JS.array(a),c,d;return this._j&&(typeof b[b.length-2]=="function"?(d=b.pop(),c=b.pop()):typeof b[b.length-1]=="function"&&(d=null,c=b.pop())),JS.Enumerable.areEqual(this._1c,b)?this._l?{exception:this._l}:this._j?{callback:c,context:d}:this._18?this._18:!0:!1},ping:function(){this._i+=1},verify:function(a,b,c){if(!this._a)return;var d=!0,e;this._i===0&&this._w===undefined&&this._x===undefined?d=!1:this._x!==undefined&&this._i!==this._x?(e=this._U("exactly"),d=!1):this._w!==undefined&&this._i>this._w?(e=this._U("at most"),d=!1):this._T!==undefined&&this._i<this._T&&(e=this._U("at least"),d=!1);if(d)return;var f;throw c?f=new JS.Test.Unit.AssertionMessage("Mock expectation not met","<?> expected to be constructed with\n(?)"+(e?"\n"+e:"")+".",[a,this.toArray()]):f=new JS.Test.Unit.AssertionMessage("Mock expectation not met","<?> expected to receive call\n"+b+"(?)"+(e?"\n"+e:"")+".",[a,this.toArray()]),new JS.Test.Mocking.ExpectationError(f)},_U:function(a){var b=this._i,c="but "+b+" call"+(b===1?" was":"s were")+" made",d={exactly:this._x,"at most":this._w,"at least":this._T};return a+" "+d[a]+" times\n"+c}})}),JS.Test.Mocking.extend({Anything
:new JS.Class({equals:function(){return!0},toString:function(){return"anything"}}),AnyArgs:new JS.Class({equals:function(){return JS.Enumerable.ALL_EQUAL},toString:function(){return"*arguments"}}),ArrayIncluding:new JS.Class({initialize:function(a){this._e=Array.prototype.slice.call(a)},equals:function(a){if(!JS.isType(a,Array))return!1;var b=this._e.length,c;d:while(b--){c=a.length;while(c--)if(JS.Enumerable.areEqual(this._e[b],a[c]))continue d;return!1}return!0},toString:function(){var a=JS.Console.convert(this._e);return"arrayIncluding("+a+")"}}),ObjectIncluding:new JS.Class({initialize:function(a){this._e=a},equals:function(a){if(!JS.isType(a,Object))return!1;for(var b in this._e)if(!JS.Enumerable.areEqual(this._e[b],a[b]))return!1;return!0},toString:function(){var a=JS.Console.convert(this._e);return"objectIncluding("+a+")"}}),InstanceOf:new JS.Class({initialize:function(a){this._8=a},equals:function(a){return JS.isType(a,this._8)},toString:function(){var a=JS.Console.convert(this._8),b=/^[aeiou]/i.test(a)?"an":"a";return b+"("+a+")"}}),Matcher:new JS.Class({initialize:function(a){this._8=a},equals:function(a){return JS.match(this._8,a)},toString:function(){var a=JS.Console.convert(this._8);return"matching("+a+")"}})}),JS.Test.Mocking.Stub.include({given:function(){var a=new JS.Test.Mocking.Parameters(arguments,this._a);return this._v.push(a),this._4=a,this},raises:function(a){return this._4._l=a,this},returns:function(){return this._4.returns(arguments),this},yields:function(){return this._4.yields(arguments),this},atLeast:function(a){return this._4.setMinimum(a),this},atMost:function(a){return this._4.setMaximum(a),this},exactly:function(a){return this._4.setExpected(a),this}}),JS.Test.Mocking.Stub.alias({raising:"raises",returning:"returns",yielding:"yields"}),JS.Test.Mocking.extend({DSL:new JS.Module({stub:function(){return JS.Test.Mocking.stub.apply(JS.Test.Mocking,arguments)},expect:function(){var a=JS.Test.Mocking.stub.apply(JS.Test.Mocking,arguments);return a.expected(),this.addAssertion(),a},anything:function(){return new JS.Test.Mocking.Anything},anyArgs:function(){return new JS.Test.Mocking.AnyArgs},instanceOf:function(a){return new JS.Test.Mocking.InstanceOf(a)},match:function(a){return new JS.Test.Mocking.Matcher(a)},arrayIncluding:function(){return new JS.Test.Mocking.ArrayIncluding(arguments)},objectIncluding:function(a){return new JS.Test.Mocking.ObjectIncluding(a)}})}),JS.Test.Unit.TestCase.include(JS.Test.Mocking.DSL),JS.Test.Unit.mocking=JS.Test.Mocking,JS.Test.extend({FakeClock:new JS.Module({extend:{API:new JS.Singleton({stub:function(){var a=JS.Test.Mocking,b=["Date","setTimeout","clearTimeout","setInterval","clearInterval"],c=b.length;JS.Test.FakeClock.reset();while(c--)a.stub(b[c],JS.Test.FakeClock.method(b[c]))},reset:function(){return JS.Test.FakeClock.reset()},tick:function(a){return JS.Test.FakeClock.tick(a)}}),JSDate:Date,Schedule:new JS.Class(JS.SortedSet,{nextScheduledAt:function(a){return this.find(function(c){return c.time<=a})}}),Timeout:new JS.Class({include:JS.Comparable,initialize:function(a,b,c){this.callback=a,this.interval=b,this.repeat=c},compareTo:function(a){return this.time-a.time},toString:function(){return(this.repeat?"Interval":"Timeout")+"("+this.interval+"):"+this.time}}),reset:function(){this._y=(new Date).getTime(),this._z=this._y,this._o=new this.Schedule},tick:function(a){this._y+=a;var b;while(b=this._o.nextScheduledAt(this._y))this._1w(b);this._z=this._y},_1w:function(a){this._z=a.time,a.callback(),a.repeat?(a.time+=a.interval,this._o.rebuild()):this.clearTimeout(a)},_1d:function(a,b,c){var d=new this.Timeout(a,b,c);return d.time=this._z+b,this._o.add(d),d},Date:function(){var a=new this.JSDate;return a.setTime(this._z),a},setTimeout:function(a,b){return this._1d(a,b,!1)},setInterval:function(a,b){return this._1d(a,b,!0)},clearTimeout:function(a){this._o.remove(a)},clearInterval:function(a){this._o.remove(a)}}})}),JS.Test.FakeClock.include({clock:JS.Test.FakeClock.API}),JS.Test.extend({AsyncSteps:new JS.Class(JS.Module,{define:function(a,b){this.callSuper(a,function(){var d=[a,b].concat(JS.array(arguments));this.__enqueue__(d)})},included:function(a){a.include(JS.Test.AsyncSteps.Sync),a.includes(JS.Test.Context)&&a.after(function(a){this.sync(a)})},extend:{Sync:new JS.Module({__enqueue__:function(a){this.__stepQueue__=this.__stepQueue__||[],this.__stepQueue__.push(a);if(this.__runningSteps__)return;this.__runningSteps__=!0;var b=JS.Test.Unit.TestSuite.setTimeout;b(this.method("__runNextStep__"),1)},__runNextStep__:function(){var a=this.__stepQueue__.shift(),b;if(!a){this.__runningSteps__=!1;if(!this.__stepCallbacks__)return;while(b=this.__stepCallbacks__.shift())b();return}var c=a.shift(),d=a.shift(),e=a.slice(),f=function(){d.apply(this,e)};e[d.length-1]=this.method("__runNextStep__");if(!this.exec)return f.call(this);this.exec(f,function(){},this.method("__endSteps__"))},__endSteps__:function(){this.__stepQueue__=[],this.__runNextStep__()},sync:function(a){if(!this.__runningSteps__)return a();this.__stepCallbacks__=this.__stepCallbacks__||[],this.__stepCallbacks__.push(a)}})}}),asyncSteps:function(a){return new this.AsyncSteps(a)}}),JS.Test.extend({Coverage:new JS.Class({initialize:function(a){this._1e=a,this._A=new JS.Hash([]);var b=function(a){var b=a.instanceMethods(!1),c=b.length;while(c--)this._A.store(a.instanceMethod(b[c]),0)};b.call(this,a),b.call(this,a.__eigen__())},attach:function(){var a=this._1e;JS.StackTrace.addObserver(this),JS.Method.trace([a,a.__eigen__()])},detach:function(){var a=this._1e;JS.Method.untrace([a,a.__eigen__()]),JS.StackTrace.removeObserver(this)},update:function(a,b){if(a!=="call")return;var c=this._A.assoc(b.method);c&&c.setValue(c.value+1)},report:function(){var a=this._A.entries().sort(function(a,b){return b.value-a.value}),b=this._A.all(function(a){return a.value>0});return JS.Console.printTable(a,function(a,b){return a[1]===0?["bgred","white"]:b%2===0?["bold"]:[]}),b}})}),JS.Test.extend({Helpers:new JS.Module({$R:function(a,b){return new JS.Range(a,b)},$w:function(a){return a.split(/\s+/)},forEach:function(a,b,c){for(var d=0,e=a.length;d<e;d++)b.call(c||null,a[d],d)},its:function(){return new JS.MethodChain},map:function(a,b,c){return(new JS.Enumerable.Collection(a)).map(b,c)},repeat:function(a,b,c){while(a--)b.call(c)}})});