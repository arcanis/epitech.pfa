JS.Console=new JS.Module("Console",{extend:{nameOf:function(a,b){var c=[],d,e,f,g;if(JS.isType(a,Array)){for(d=0,e=a.length;d<e;d++)c.push(this.nameOf(a[d]));return c}if(a.displayName)return a.displayName;f=[{name:null,o:b||JS.ENV}],g=0;while(typeof f=="object"&&g<this.MAX_DEPTH)g+=1,f=this.descend(f,a);return typeof f=="string"&&(f=f.replace(/\.prototype\./g,"#"),a.displayName=f,a.__meta__&&(a.__meta__.displayName=f+".__meta__")),a.displayName},descend:function(a,b){var c=[],d=a.length,e=d,f,g,h;while(e--){g=a[e];if(JS.isType(g.o,Array))continue;h=g.name?g.name+".":"";for(f in g.o){if(b&&g.o[f]===b)return h+f;c.push({name:h+f,o:g.o[f]})}}return c},MAX_DEPTH:4,convert:function(a,b){if(!a)return String(a);var c=JS.Enumerable,b=b||[],d;return JS.indexOf(b,a)>=0?"#circular":a instanceof Error?typeof a.message=="string"&&!a.message?a.name:a.name+(a.message?": "+a.message:""):a instanceof Array?(b.push(a),d=(new c.Collection(a)).map(function(a){return this.convert(a,b)},this).join(", "),b.pop(),d?"[ "+d+" ]":"[]"):a instanceof String||typeof a=="string"?'"'+a+'"':a instanceof Function?a.displayName||a.name||(a.toString().match(/^\s*function ([^\(]+)\(/)||[])[1]||"#function":a.toString&&a.toString!==Object.prototype.toString&&!a.toString.__traced__?a.toString():(b.push(a),d=(new c.Collection(c.objectKeys(a,!1).sort())).map(function(c){return this.convert(c,b)+": "+this.convert(a[c],b)},this).join(", "),b.pop(),d?"{ "+d+" }":"{}")},ANSI_CSI:String.fromCharCode(27)+"[",MAX_BUFFER_LENGTH:78,BROWSER:typeof window!="undefined",NODE:typeof process=="object",RHINO:typeof java!="undefined"&&typeof java.lang!="undefined",WINDOZE:typeof window!="undefined"||typeof WScript!="undefined",WSH:typeof WScript!="undefined",coloring:function(){return(!this.BROWSER||!!window.runtime)&&!this.WINDOZE},__buffer__:"",__format__:"",ESCAPE_CODES:{reset:0,bold:1,normal:22,underline:4,noline:24,blink:5,noblink:25,black:30,bgblack:40,red:31,bgred:41,green:32,bggreen:42,yellow:33,bgyellow:43,blue:34,bgblue:44,magenta:35,bgmagenta:45,cyan:36,bgcyan:46,white:37,bgwhite:47,nocolor:39,bgnocolor:49},escape:function(a){return this.ANSI_CSI+a},repeat:function(a,b){var c="";while(b--)c+=a;return c},pad:function(a,b){return a=(a===undefined?"":a).toString(),a+this.repeat(" ",b-a.length)},flushFormat:function(){var a=this.__format__;return this.__format__="",a},output:function(a,b){while(a.length>0){var c=this.__buffer__.length,d=this.BROWSER?1e3:this.MAX_BUFFER_LENGTH,e=c>0&&this.coloring(),f=e?this.escape("1F")+this.escape(c+1+"G"):"",g=a.substr(0,d-c);this.__buffer__+=g,this.coloring()?this.writeToStdout(f+this.flushFormat()+g):this.__buffer__.length===d&&this.writeToStdout(this.__buffer__),this.__buffer__.length===d&&(this.__buffer__=""),a=a.substr(d-c)}b||(a===""&&!this.__buffer__&&this.writeToStdout(this.flushFormat()+""),!this.coloring()&&this.__buffer__&&this.writeToStdout(this.__buffer__),this.__buffer__="")},writeToStdout:function(a){if(this.BROWSER&&window.runtime)return window.runtime.trace(a);if(this.NODE)return console.warn(a);if(this.RHINO)return java.lang.System.out.println(a);if(this.WSH)return WScript.Echo(a);if(typeof console!="undefined")return console.log(a);if(typeof alert=="function")return alert(a);if(typeof print=="function")return print(a)}},consoleFormat:function(){if(!JS.Console.coloring())return;this.reset();var a=arguments.length;while(a--)this[arguments[a]]()},puts:function(a){a=(a===undefined?"":a).toString();var b=JS.Console;b.NODE||b.RHINO?(b.writeToStdout(b.flushFormat()+a),b.__print__=!1):b.output(a,!1)},print:function(a){a=(a===undefined?"":a).toString();var b=JS.Console;b.NODE?(require("sys").print(b.flushFormat()+a),b.__print__=!0):b.RHINO?(java.lang.System.out.print(b.flushFormat()+a),b.__print__=!0):b.output(a,!0)},printTable:function(a,b){var c=[],a=[["Method","Calls"]].concat(a),d=JS.Console,e=a.length,f,g;while(e--){f=a[e].length;while(f--)c[f]=c[f]||0,g=(a[e][f]===undefined?"":a[e][f]).toString(),c[f]=Math.max(g.length,c[f])}var h="+",f=c.length;while(f--)h="+"+d.repeat("-",c[f]+2)+h;h="  "+h,this.reset(),this.puts(),this.puts(h);var i=function(b,e){var f=a[b];this.reset(),this.print("  ");for(var g=0,h=f.length;g<h;g++)this.reset(),this.print("|"),this.consoleFormat.apply(this,e),this.print(" "+d.pad(f[g],c[g])+" ");this.reset(),this.puts("|")};i.call(this,0,["bold"]),this.reset(),this.puts(h);for(var e=1,j=a.length;e<j;e++){var k=b?b(a[e],e):[];i.call(this,e,k)}this.reset(),this.puts(h)}}),function(){var a=JS.Console;for(var b in a.ESCAPE_CODES)(function(b){a.define(b,function(){if(!JS.Console.coloring())return;var d=a.ESCAPE_CODES[b];a.__format__+=a.escape(d+"m")})})(b);a.extend(a)}();