JS.Enumerable=new JS.Module("Enumerable",{extend:{ALL_EQUAL:{},forEach:function(a,b){if(!a)return new JS.Enumerator(this,"forEach");for(var c=0;c<this.length;c++)a.call(b||null,this[c]);return this},isComparable:function(a){return a.all(function(a){return typeof a.compareTo=="function"})},areEqual:function(a,b){var c;if(a===b)return!0;if(a&&typeof a.equals=="function")return a.equals(b);if(a instanceof Function)return a===b;if(a instanceof Array){if(b instanceof Array){for(var d=0,e=a.length;d<e;d++){c=this.areEqual(a[d],b[d]);if(c===this.ALL_EQUAL)return!0;if(!c)return!1}return a.length!==b.length?!1:!0}return!1}if(a instanceof Object){if(b instanceof Object){if(this.objectSize(a)!==this.objectSize(b))return!1;for(var f in a)if(!this.areEqual(a[f],b[f]))return!1;return!0}return!1}return!1},objectKeys:function(a,b){var c=[];for(var d in a)(a.hasOwnProperty(d)||b!==!1)&&c.push(d);return c},objectSize:function(a){return this.objectKeys(a).length},Collection:new JS.Class({initialize:function(a){this.length=0,JS.Enumerable.forEach.call(a,this.push,this)},push:function(a){Array.prototype.push.call(this,a)},clear:function(){var a=this.length;while(a--)delete this[a];this.length=0}})},all:function(a,b){a=JS.Enumerable.toFn(a);var c=!0;return this.forEach(function(e){c=c&&(a?a.apply(b||null,arguments):e)}),!!c},any:function(a,b){a=JS.Enumerable.toFn(a);var c=!1;return this.forEach(function(e){c=c||(a?a.apply(b||null,arguments):e)}),!!c},count:function(a,b){if(typeof this.size=="function")return this.size();var c=0,d=a;return a&&typeof a!="function"&&(a=function(a){return JS.Enumerable.areEqual(a,d)}),this.forEach(function(){if(!a||a.apply(b||null,arguments))c+=1}),c},cycle:function(a,b,c){if(!b)return this.enumFor("cycle",a);b=JS.Enumerable.toFn(b);while(a--)this.forEach(b,c)},drop:function(a){var b=[];return this.forEachWithIndex(function(e,f){f>=a&&b.push(e)}),b},dropWhile:function(a,b){if(!a)return this.enumFor("dropWhile");a=JS.Enumerable.toFn(a);var c=[],d=!0;return this.forEach(function(f){d&&(d=d&&a.apply(b||null,arguments)),d||c.push(f)}),c},forEachCons:function(a,b,c){if(!b)return this.enumFor("forEachCons",a);b=JS.Enumerable.toFn(b);var d=this.toArray(),e=d.length,f=e-a,g;for(g=0;g<=f;g++)b.call(c||null,d.slice(g,g+a));return this},forEachSlice:function(a,b,c){if(!b)return this.enumFor("forEachSlice",a);b=JS.Enumerable.toFn(b);var d=this.toArray(),e=d.length,f=Math.ceil(e/a),g;for(g=0;g<f;g++)b.call(c||null,d.slice(g*a,(g+1)*a));return this},forEachWithIndex:function(a,b,c){return typeof a=="function"&&(c=b,b=a,a=0),a=a||0,b?(b=JS.Enumerable.toFn(b),this.forEach(function(f){var g=b.call(c||null,f,a);return a+=1,g})):this.enumFor("forEachWithIndex",a)},forEachWithObject:function(a,b,c){return b?(b=JS.Enumerable.toFn(b),this.forEach(function(){var e=[a].concat(JS.array(arguments));b.apply(c||null,e)}),a):this.enumFor("forEachWithObject",a)},find:function(a,b){if(!a)return this.enumFor("find");a=JS.Enumerable.toFn(a);var c={},d=c;return this.forEach(function(f){if(c!==d)return;c=a.apply(b||null,arguments)?f:c}),c===d?null:c},findIndex:function(a,b){if(a===undefined)return this.enumFor("findIndex");var c=null,d=typeof a=="function";return this.forEachWithIndex(function(g,h){if(c!==null)return;if(JS.Enumerable.areEqual(a,g)||d&&a.apply(b||null,arguments))c=h}),c},first:function(a){var b=this.toArray();return a===undefined?b[0]:b.slice(0,a)},grep:function(a,b,c){b=JS.Enumerable.toFn(b);var d=[];return this.forEach(function(g){var h=typeof a.match=="function"?a.match(g):typeof a.test=="function"?a.test(g):JS.isType(g,a);if(!h)return;b&&(g=b.apply(c||null,arguments)),d.push(g)}),d},groupBy:function(a,b){if(!a)return this.enumFor("groupBy");a=JS.Enumerable.toFn(a);var c=new JS.Hash;return this.forEach(function(f){var g=a.apply(b||null,arguments);c.hasKey(g)||c.store(g,[]),c.get(g).push(f)}),c},inject:function(a,b,c){var d=JS.array(arguments),e=0,f={};switch(d.length){case 1:a=f,b=d[0];break;case 2:typeof a=="function"&&(a=f,b=d[0],c=d[1])}return b=JS.Enumerable.toFn(b),this.forEach(function(d){if(!(e++)&&a===f)return a=d;var i=[a].concat(JS.array(arguments));a=b.apply(c||null,i)}),a},map:function(a,b){if(!a)return this.enumFor("map");a=JS.Enumerable.toFn(a);var c=[];return this.forEach(function(){c.push(a.apply(b||null,arguments))}),c},max:function(a,b){return this.minmax(a,b)[1]},maxBy:function(a,b){return a?this.minmaxBy(a,b)[1]:this.enumFor("maxBy")},member:function(a){return this.any(function(c){return JS.Enumerable.areEqual(c,a)})},min:function(a,b){return this.minmax(a,b)[0]},minBy:function(a,b){return a?this.minmaxBy(a,b)[0]:this.enumFor("minBy")},minmax:function(a,b){var c=this.sort(a,b);return[c[0],c[c.length-1]]},minmaxBy:function(a,b){if(!a)return this.enumFor("minmaxBy");var c=this.sortBy(a,b);return[c[0],c[c.length-1]]},none:function(a,b){return!this.any(a,b)},one:function(a,b){a=JS.Enumerable.toFn(a);var c=0;return this.forEach(function(e){if(a?a.apply(b||null,arguments):e)c+=1}),c===1},partition:function(a,b){if(!a)return this.enumFor("partition");a=JS.Enumerable.toFn(a);var c=[],d=[];return this.forEach(function(f){(a.apply(b||null,arguments)?c:d).push(f)}),[c,d]},reject:function(a,b){if(!a)return this.enumFor("reject");a=JS.Enumerable.toFn(a);var c=[];return this.forEach(function(e){a.apply(b||null,arguments)||c.push(e)}),c},reverseForEach:function(a,b){if(!a)return this.enumFor("reverseForEach");a=JS.Enumerable.toFn(a);var c=this.toArray(),d=c.length;while(d--)a.call(b||null,c[d]);return this},select:function(a,b){if(!a)return this.enumFor("select");a=JS.Enumerable.toFn(a);var c=[];return this.forEach(function(e){a.apply(b||null,arguments)&&c.push(e)}),c},sort:function(a,b){var c=JS.Enumerable.isComparable(this),d=this.toArray();return a=a||(c?function(a,b){return a.compareTo(b)}:null),a?d.sort(function(c,d){return a.call(b||null,c,d)}):d.sort()},sortBy:function(a,b){if(!a)return this.enumFor("sortBy");a=JS.Enumerable.toFn(a);var c=JS.Enumerable,d=new c.Collection(this.map(a,b)),e=c.isComparable(d);return(new c.Collection(d.zip(this).sort(function(a,b){return a=a[0],b=b[0],e?a.compareTo(b):a<b?-1:a>b?1:0}))).map(function(a){return a[1]})},take:function(a){var b=[];return this.forEachWithIndex(function(e,f){f<a&&b.push(e)}),b},takeWhile:function(a,b){if(!a)return this.enumFor("takeWhile");a=JS.Enumerable.toFn(a);var c=[],d=!0;return this.forEach(function(f){d&&(d=d&&a.apply(b||null,arguments)),d&&c.push(f)}),c},toArray:function(){return this.drop(0)},zip:function(){var a=JS.Enumerable,b=[],c=0,d=arguments.length,e,f;typeof arguments[d-1]=="function"&&(e=arguments[d-1],f={}),typeof arguments[d-2]=="function"&&(e=arguments[d-2],f=arguments[d-1]),a.forEach.call(arguments,function(a){if(a===e||a===f)return;a.toArray&&(a=a.toArray()),JS.isType(a,Array)&&b.push(a)});var g=this.map(function(d){var e=[d];return a.forEach.call(b,function(a){e.push(a[c]===undefined?null:a[c])}),++c&&e});if(!e)return g;a.forEach.call(g,e,f)}}),JS.Enumerable.define("forEach",JS.Enumerable.forEach),JS.Enumerable.alias({collect:"map",detect:"find",entries:"toArray",every:"all",findAll:"select",filter:"select",some:"any"}),JS.Enumerable.extend({toFn:function(a){return a?a.toFunction?a.toFunction():this.OPS[a]?this.OPS[a]:JS.isType(a,"string")||JS.isType(a,String)?function(){var b=JS.array(arguments),c=b.shift(),d=c[a];return typeof d=="function"?d.apply(c,b):d}:a:a},OPS:{"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"^":function(a,b){return a^b},"&":function(a,b){return a&b},"&&":function(a,b){return a&&b},"|":function(a,b){return a|b},"||":function(a,b){return a||b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"[]":function(a,b){return a[b]},"()":function(a,b){return a(b)}},Enumerator:new JS.Class({include:JS.Enumerable,extend:{DEFAULT_METHOD:"forEach"},initialize:function(a,b,c){this._0=a,this._1=b||this.klass.DEFAULT_METHOD,this._2=(c||[]).slice()},equals:function(a){return JS.isType(a,this.klass)&&this._0===a._0&&this._1===a._1&&JS.Enumerable.areEqual(this._2,a._2)},forEach:function(a,b){if(!a)return this;var c=this._2.slice();return c.push(a),b&&c.push(b),this._0[this._1].apply(this._0,c)}})}),JS.Enumerable.Enumerator.alias({cons:"forEachCons",reverse:"reverseForEach",slice:"forEachSlice",withIndex:"forEachWithIndex",withObject:"forEachWithObject"}),JS.Enumerable.Collection.include(JS.Enumerable),JS.Kernel.include({enumFor:function(a){var b=JS.array(arguments),a=b.shift();return new JS.Enumerable.Enumerator(this,a,b)}},{_3:!1}),JS.Kernel.alias({toEnum:"enumFor"});