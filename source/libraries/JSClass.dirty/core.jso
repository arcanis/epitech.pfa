(function(){var a=typeof this.global=="object"?this.global:this;a.JS=a.JS||{},JS.ENV=a})(),JS.END_WITHOUT_DOT=/([^\.])$/,JS.array=function(a){var b=[],c=a.length;while(c--)b[c]=a[c];return b},JS.bind=function(a,b){return function(){return a.apply(b,arguments)}},JS.extend=function(a,b,c){if(!a||!b)return a;for(var d in b){if(a[d]===b[d])continue;if(c===!1&&a.hasOwnProperty(d))continue;a[d]=b[d]}return a},JS.indexOf=function(a,b){if(a.indexOf)return a.indexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},JS.isType=function(a,b){return typeof b=="string"?typeof a===b:a===null||a===undefined?!1:typeof b=="function"&&a instanceof b||a.isA&&a.isA(b)||a.constructor===b},JS.makeBridge=function(a){var b=function(){};return b.prototype=a.prototype,new b},JS.makeClass=function(a){a=a||Object;var b=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this};return b.prototype=JS.makeBridge(a),b.superclass=a,b.subclasses=[],a.subclasses&&a.subclasses.push(b),b},JS.match=function(a,b){return b===undefined?!1:typeof a.test=="function"?a.test(b):a.match(b)},JS.Method=JS.makeClass(),JS.extend(JS.Method.prototype,{initialize:function(a,b,c){this.module=a,this.name=b,this.callable=c,this._1={};if(typeof c!="function")return;this.arity=c.length;var d=c.toString().match(/\b[a-z\_\$][a-z0-9\_\$]*\b/ig),e=d.length;while(e--)this._1[d[e]]=!0},setName:function(a){this.callable.displayName=this.displayName=a},contains:function(a){return this._1.hasOwnProperty(a)},call:function(){return this.callable.call.apply(this.callable,arguments)},apply:function(a,b){return this.callable.apply(a,b)},compile:function(a){var b=this,c=b.module.__trace__||a.__trace__,d=b.callable,e=b._1,f=JS.Method._3,g=f.length,h=[],i;while(g--)i=f[g],e[i.name]&&h.push(i);if(h.length===0&&!c)return d;var j=function(){var c=h.length,e=c,f={},g,i,j;while(e--){g=h[e],i=this[g.name];if(i&&!i.__kwd__)continue;f[g.name]={_2:i,_4:this.hasOwnProperty(g.name)},j=g.filter(b,a,this,arguments),j.__kwd__=!0,this[g.name]=j}var m=d.apply(this,arguments),e=c;while(e--){g=h[e];if(!f[g.name])continue;f[g.name]._4?this[g.name]=f[g.name]._2:delete this[g.name]}return m};return c?JS.StackTrace.wrap(j,b,a):j},toString:function(){var a=this.displayName||this.module.toString()+"#"+this.name;return"#<Method:"+a+">"}}),JS.Method.create=function(a,b,c){if(c&&c.__inc__&&c.__fns__)return c;var d=typeof c!="function"?c:new this(a,b,c);return this.notify(d),d},JS.Method.compile=function(a,b){return a&&a.compile?a.compile(b):a},JS.Method.__listeners__=[],JS.Method.added=function(a,b){this.__listeners__.push([a,b])},JS.Method.notify=function(a){var b=this.__listeners__,c=b.length,d;while(c--)d=b[c],d[0].call(d[1],a)},JS.Method._3=[],JS.Method.keyword=function(a,b){this._3.push({name:a,filter:b})},JS.Method.tracing=function(a,b,c){JS.require("JS.StackTrace",function(){var f=JS.StackTrace.logger,g=f.active;a=[].concat(a),this.trace(a),f.active=!0,b.call(c),this.untrace(a),f.active=g},this)},JS.Method.trace=function(a){var b=a.length;while(b--)a[b].__trace__=!0,a[b].resolve()},JS.Method.untrace=function(a){var b=a.length;while(b--)a[b].__trace__=!1,a[b].resolve()},JS.Module=JS.makeClass(),JS.Module.__queue__=[],JS.extend(JS.Module.prototype,{initialize:function(a,b,c){typeof a!="string"&&(c=arguments[1],b=arguments[0],a=undefined),c=c||{},this.__inc__=[],this.__dep__=[],this.__fns__={},this.__tgt__=c._5,this.__anc__=null,this.__mct__={},this.setName(a),this.include(b,{_0:!1}),JS.Module.__queue__&&JS.Module.__queue__.push(this)},setName:function(a){this.displayName=a||"";for(var b in this.__fns__)this.__name__(b);a&&this.__meta__&&this.__meta__.setName(a+".")},__name__:function(a){if(!this.displayName)return;var b=this.__fns__[a];if(!b)return;a=this.displayName.replace(JS.END_WITHOUT_DOT,"$1#")+a;if(typeof b.setName=="function")return b.setName(a);typeof b=="function"&&(b.displayName=a)},define:function(a,b,c){var d=JS.Method.create(this,a,b),e=(c||{})._0;this.__fns__[a]=d,this.__name__(a),e!==!1&&this.resolve()},include:function(a,b){if(!a)return this;var b=b||{},c=b._0!==!1,d=a.extend,e=a.include,f,g,h,i,j,k;if(a.__fns__&&a.__inc__)this.__inc__.push(a),(a.__dep__||{}).push&&a.__dep__.push(this),(f=b._6)?typeof a.extended=="function"&&a.extended(f):typeof a.included=="function"&&a.included(this);else{if(this.shouldIgnore("extend",d)){i=[].concat(d);for(j=0,k=i.length;j<k;j++)this.extend(i[j])}if(this.shouldIgnore("include",e)){i=[].concat(e);for(j=0,k=i.length;j<k;j++)this.include(i[j],{_0:!1})}for(g in a){if(!a.hasOwnProperty(g))continue;h=a[g];if(this.shouldIgnore(g,h))continue;this.define(g,h,{_0:!1})}a.hasOwnProperty("toString")&&this.define("toString",a.toString,{_0:!1})}return c&&this.resolve(),this},alias:function(a){for(var b in a){if(!a.hasOwnProperty(b))continue;this.define(b,this.instanceMethod(a[b]),{_0:!1})}this.resolve()},resolve:function(a){var a=a||this,b=a.__tgt__,c=this.__inc__,d=this.__fns__,e,f,g,h;if(a===this){this.__anc__=null,this.__mct__={},e=this.__dep__.length;while(e--)this.__dep__[e].resolve()}if(!b)return;for(e=0,f=c.length;e<f;e++)c[e].resolve(a);for(g in d)h=JS.Method.compile(d[g],a),b[g]!==h&&(b[g]=h);d.hasOwnProperty("toString")&&(b.toString=JS.Method.compile(d.toString,a))},shouldIgnore:function(a,b){return(a==="extend"||a==="include")&&(typeof b!="function"||b.__fns__&&b.__inc__)},ancestors:function(a){var b=!a,a=a||[],c=this.__inc__;if(b&&this.__anc__)return this.__anc__.slice();for(var d=0,e=c.length;d<e;d++)c[d].ancestors(a);return JS.indexOf(a,this)<0&&a.push(this),b&&(this.__anc__=a.slice()),a},lookup:function(a){var b=this.__mct__[a];if(b&&b.slice)return b.slice();var c=this.ancestors(),d=[],e;for(var f=0,g=c.length;f<g;f++)e=c[f].__fns__,e.hasOwnProperty(a)&&d.push(e[a]);return this.__mct__[a]=d.slice(),d},includes:function(a){if(a===this)return!0;var b=this.__inc__;for(var c=0,d=b.length;c<d;c++)if(b[c].includes(a))return!0;return!1},instanceMethod:function(a){return this.lookup(a).pop()},instanceMethods:function(a,b){var c=b||[],d=this.__fns__,e;for(e in d){if(!JS.isType(this.__fns__[e],JS.Method))continue;if(JS.indexOf(c,e)>=0)continue;c.push(e)}if(a!==!1){var f=this.ancestors(),g=f.length;while(g--)f[g].instanceMethods(!1,c)}return c},match:function(a){return a&&a.isA&&a.isA(this)},toString:function(){return this.displayName}}),JS.Kernel=new JS.Module("Kernel",{__eigen__:function(){if(this.__meta__)return this.__meta__;var a=this.toString()+".";return this.__meta__=new JS.Module(a,null,{_5:this}),this.__meta__.include(this.klass,{_0:!1})},equals:function(a){return this===a},extend:function(a,b){var c=(b||{})._0;return this.__eigen__().include(a,{_6:this,_0:c}),this},hash:function(){return JS.Kernel.hashFor(this)},isA:function(a){return typeof a=="function"&&this instanceof a||this.__eigen__().includes(a)},method:function(a){var b=this.__mct__=this.__mct__||{},c=b[a],d=this[a];if(typeof d!="function")return d;if(c&&d===c._2)return c._7;var e=JS.bind(d,this);return b[a]={_2:d,_7:e},e},methods:function(){return this.__eigen__().instanceMethods()},tap:function(a,b){return a.call(b||null,this),this},toString:function(){if(this.displayName)return this.displayName;var a=this.klass.displayName||this.klass.toString();return"#<"+a+":"+this.hash()+">"}}),function(){var a=1;JS.Kernel.hashFor=function(c){return c.__hash__!==undefined?c.__hash__:(c.__hash__=((new Date).getTime()+a).toString(16),a+=1,c.__hash__)}}(),JS.Class=JS.makeClass(JS.Module),JS.extend(JS.Class.prototype,{initialize:function(a,b,c,d){typeof a!="string"&&(d=arguments[2],c=arguments[1],b=arguments[0],a=undefined),typeof b!="function"&&(d=c,c=b,b=Object),JS.Module.prototype.initialize.call(this,a),d=d||{};var e=JS.makeClass(b);JS.extend(e,this),e.prototype.constructor=e.prototype.klass=e,e.__eigen__().include(b.__meta__,{_0:d._0}),e.setName(a),e.__tgt__=e.prototype;var f=b===Object?{}:b.__fns__?b:new JS.Module(b.prototype,{_0:!1});return e.include(JS.Kernel,{_0:!1}).include(f,{_0:!1}).include(c,{_0:!1}),d._0!==!1&&e.resolve(),typeof b.inherited=="function"&&b.inherited(e),e}}),function(){var a=function(a){var b={},c=a.prototype;for(var d in c){if(!c.hasOwnProperty(d))continue;b[d]=JS.Method.create(a,d,c[d])}return b},b=function(b,c){var d=JS[b],f=JS[c];d.__inc__=[],d.__dep__=[],d.__fns__=a(d),d.__tgt__=d.prototype,d.prototype.constructor=d.prototype.klass=d,JS.extend(d,JS.Class.prototype),d.include(f||JS.Kernel),d.setName(b),d.constructor=d.klass=JS.Class};b("Method"),b("Module"),b("Class","Module");var c=JS.Kernel.instanceMethod("__eigen__");c.call(JS.Method),c.call(JS.Module),c.call(JS.Class).include(JS.Module.__meta__)}(),JS.NotImplementedError=new JS.Class("NotImplementedError",Error),JS.Method.keyword("callSuper",function(a,b,c,d){var e=b.lookup(a.name),f=e.length-1,g=JS.array(d);return function(){var a=arguments.length;while(a--)g[a]=arguments[a];f-=1;var b=e[f].apply(c,g);return f+=1,b}}),JS.Method.keyword("blockGiven",function(a,b,c,d){var e=Array.prototype.slice.call(d,a.arity),f=typeof e[0]=="function";return function(){return f}}),JS.Method.keyword("yieldWith",function(a,b,c,d){var e=Array.prototype.slice.call(d,a.arity);return function(){if(typeof e[0]!="function")return;return e[0].apply(e[1]||null,arguments)}}),JS.Interface=new JS.Class("Interface",{initialize:function(a){this.test=function(b,c){var e=a.length;while(e--)if(typeof b[a[e]]!="function")return c?a[e]:!1;return!0}},extend:{ensure:function(){var a=JS.array(arguments),b=a.shift(),c,d;while(c=a.shift()){d=c.test(b,!0);if(d!==!0)throw new Error("object does not implement "+d+"()")}}}}),JS.Singleton=new JS.Class("Singleton",{initialize:function(a,b,c){return new new JS.Class(a,b,c)}});